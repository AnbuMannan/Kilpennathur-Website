// Prisma schema for Kilpennathur community news website
// https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

/* ---------------------------------------------------------------------------
   User & authentication
   --------------------------------------------------------------------------- */

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("editor")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  news News[]
}

/* ---------------------------------------------------------------------------
   News & content
   --------------------------------------------------------------------------- */

model News {
  id           String    @id @default(cuid())
  title        String
  titleTamil   String?
  slug         String    @unique
  content      String    @db.Text
  contentTamil String?   @db.Text
  excerpt      String?
  image        String?
  category     String
  tags         String    @default("")
  status       String    @default("draft")
  whatsappLink String?
  referenceUrl String?
  views        Int       @default(0)
  publishedAt  DateTime?
  authorId     String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  author User @relation(fields: [authorId], references: [id])

  // Indexes
  @@index([slug])
  @@index([category])
  @@index([status])
}

model Category {
  id         String   @id @default(cuid())
  name       String
  nameTamil  String?
  slug       String   @unique
  type       String
  createdAt  DateTime @default(now())

  // Indexes
  @@index([type])
}

/* ---------------------------------------------------------------------------
   Business directory
   --------------------------------------------------------------------------- */

model Business {
  id          String   @id @default(cuid())
  name        String
  nameTamil   String?
  category    String
  phone       String?
  whatsapp    String?
  address     String?
  description String?  @db.Text
  image       String?
  website     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Indexes
  @@index([category])
}

/* ---------------------------------------------------------------------------
   Village
   --------------------------------------------------------------------------- */

model Village {
  id          String   @id @default(cuid())
  name        String
  nameTamil   String
  slug        String   @unique
  description String?  @db.Text
  image       String?
  createdAt   DateTime @default(now())

  // Indexes
  @@index([slug])
}

/* ---------------------------------------------------------------------------
   Events
   --------------------------------------------------------------------------- */

model Event {
  id          String   @id @default(cuid())
  title       String
  titleTamil  String?
  description String?  @db.Text
  date        DateTime
  image       String?
  createdAt   DateTime @default(now())
}

/* ---------------------------------------------------------------------------
   Contact messages
   --------------------------------------------------------------------------- */

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String   @db.Text
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([createdAt])
}

/* ---------------------------------------------------------------------------
   Jobs
   --------------------------------------------------------------------------- */

model Job {
  id                 String    @id @default(cuid())
  title              String
  titleTamil         String?
  slug               String    @unique
  description        String    @db.Text
  company            String
  companyTamil       String?
  location           String?
  locationTamil      String?
  jobType            String    // full-time, part-time, contract, internship, temporary
  category           String    // IT, Healthcare, Education, Government, Retail, etc.
  salaryDescription  String?   @db.Text // e.g. "As per industry standards" or "₹15,000 - ₹25,000"
  contactEmail       String?
  contactPhone       String?
  applicationUrl     String?
  applicationDeadline DateTime?
  experience         String?   // e.g. "1-3 years", "Fresher"
  qualifications     String?   @db.Text
  benefits           String?   @db.Text
  image              String?
  status             String    @default("draft") // draft, published, closed
  publishedAt        DateTime?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  @@index([status])
  @@index([category])
  @@index([jobType])
  @@index([publishedAt])
}

/* ---------------------------------------------------------------------------
   Newsletter subscribers
   --------------------------------------------------------------------------- */

model NewsletterSubscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())

  @@index([email])
}

/* ---------------------------------------------------------------------------
   Share analytics
   --------------------------------------------------------------------------- */

model ShareAnalytics {
  id        String   @id @default(cuid())
  newsId    String
  platform  String   // facebook, twitter, whatsapp
  count     Int      @default(0)
  createdAt DateTime @default(now())

  @@unique([newsId, platform])
  @@index([newsId])
}

/* ---------------------------------------------------------------------------
   Site settings
   --------------------------------------------------------------------------- */

model SiteSetting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  label       String
  description String?
  category    String   // "pagination", "display", "seo", etc.
  updatedAt   DateTime @updatedAt

  @@index([category])
}
